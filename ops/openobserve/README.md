<!--
Local guidance for running OpenObserve in this template repo.
Do NOT commit plaintext .env.local files. Use the encrypted .secrets.env.sops and the
provided helper scripts to run docker compose with secrets injected into the process.
-->

# OpenObserve (local)

This folder contains a Docker Compose configuration to run OpenObserve locally.

Security-first notes

-   Secrets are stored encrypted in the repository using SOPS (`.secrets.env.sops`).
-   Never commit plaintext files such as `ops/openobserve/.env.local` or `.env`.
-   `ZO_ROOT_USER_PASSWORD` must be provided explicitly (no default); export it or rely on the SOPS-managed secret before starting Docker Compose.
-   Use the top-level `scripts/run-with-secrets.sh` helper to run commands with secrets
    decrypted into the process environment (no plaintext file written to disk).

Quick diagnostic commands (from repo root)

```zsh
# show whether encrypted secrets file exists
ls -la .secrets.env.sops

# try a safe decrypt to stdout (requires sops + key)
sops -d .secrets.env.sops | sed -n '1,120p'

# test whether sops can export the OpenObserve-related vars into a shell
sops exec-env .secrets.env.sops 'env | grep -E "ZO_ROOT_USER|OPENOBSERVE|OPENOBSERVE_TOKEN"' || echo 'sops exec-env failed'

# show whether ops/openobserve/.env.local exists (docker-compose env_file)
ls -la ops/openobserve/.env.local || echo 'ops/openobserve/.env.local not present'

# recommended: run docker compose with secrets loaded in a subshell
./scripts/run-with-secrets.sh bash -c 'cd ops/openobserve && docker compose up -d'
```

Recommended usage

-   Run OpenObserve with decrypted secrets injected into the process environment (no plaintext file):

```zsh
# from repo root
./scripts/run-with-secrets.sh bash -c 'cd ops/openobserve && docker compose up -d'
```

Alternative (short-lived plaintext file - not recommended):

```zsh
# decrypt into the docker-compose env file expected by the service
sops -d .secrets.env.sops > ops/openobserve/.env.local
chmod 600 ops/openobserve/.env.local
(cd ops/openobserve && docker compose up -d)
# when done, remove the plaintext file
shred -u ops/openobserve/.env.local
```

CI pattern (GitHub Actions) â€” decrypt securely in the job

```yaml
- name: Decrypt secrets
  run: |
      printf "%s" "${{ secrets.SOPS_AGE_KEY }}" > "$RUNNER_TEMP/sops.key"
      export SOPS_AGE_KEY_FILE="$RUNNER_TEMP/sops.key"
      sops -d .secrets.env.sops > .env

- name: Start OpenObserve
  run: |
      cd ops/openobserve
      docker compose up -d
```

If you hit SOPS decryption errors

-   Verify `sops` is installed and you have the correct private key (AGE/GCP/KMS).
-   Locally the repo prefers `${HOME}/.config/sops/key.txt` as `SOPS_AGE_KEY_FILE` (see `.envrc`).
-   Example test with explicit key file:

```zsh
export SOPS_AGE_KEY_FILE="${HOME}/.config/sops/key.txt"
sops exec-env .secrets.env.sops 'env | grep ZO_ROOT_USER_PASSWORD'
```

Contact / traceability

-   See repository SOPS config in `.sops.yaml` for which files/keys are targeted.
-   The `.githooks/pre-commit` enforces committing only encrypted secrets.

---

Generated by automation to document secure OpenObserve startup.

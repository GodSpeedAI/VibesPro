name: 'Setup mise'
description: 'Install mise and cache runtimes'
outputs:
  cache-hit:
    description: 'Whether cache was hit'
    value: ${{ steps.cache.outputs.cache-hit }}
runs:
  using: 'composite'
  steps:
    - name: Install mise
      shell: bash
      run: |
        if command -v mise &>/dev/null; then
          echo "mise already installed"
        else
          curl https://mise.run | bash
          echo "$HOME/.local/bin" >> $GITHUB_PATH
        fi
        mise --version
        mise trust --yes .mise.toml
    - name: Cache mise runtimes
      id: cache
      uses: actions/cache@0057852bfaa89a56745cba8c7296529d2fc39830 # v4.3.0
      with:
        path: |
          ~/.local/share/mise
          ~/.cache/mise
        key: mise-${{ runner.os }}-${{ hashFiles('.mise.toml', 'rust-toolchain.toml') }}
        restore-keys: mise-${{ runner.os }}-
    - name: Install runtimes
      if: steps.cache.outputs.cache-hit != 'true'
      shell: bash
      run: mise install
